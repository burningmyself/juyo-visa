<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <title>添加</title>
    <link rel="stylesheet" href="/res/plugin/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/res/plugin/kendoui/styles/kendo.common.min.css"/>
    <link rel="stylesheet" href="/res/plugin/kendoui/styles/kendo.office365.min.css"/>
    <link rel="stylesheet" href="/res/plugin/font-awesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="/res/css/colors.min.css"/>
    <link rel="stylesheet" href="/res/css/common.min.css?v=1"/>
    <link rel="stylesheet" href="/res/plugin/h+/css/main.css"/><!--修改的样式-->
</head>
<body>
<div>
    <div class="container-fluid" style="padding-top: 15px;">
        <div class="row">
            <div class="col-xs-12 padding-0">
                <ul id="panelbar">
                    <li>
                    	<form id="updateForm" method="post">
	                        <div class="container-fluid">
	                        	<!-- 用户名称    用户名/手机号 -->
	                        	<input id="uid" name="id" type="hidden" value="" />
	                            <div class="row">
	                                <div class="col-xs-6">
	                                    <div class="form-group">
	                                        <label for="last_name_cn">用户姓名:<span style="color: red">*</span></label>
	                                        <div class='input-group'>
	                                            <input id="fullNameId" name="fullName" type="text" class="k-textbox" style="width: 100%;"/>
	                                            <span class='input-group-addon'><i class='fa fa-lg fa-fw fa-lightbulb-o'></i></span>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div class="col-xs-6">
	                                    <div class="form-group">
	                                        <label for="last_name_en">用户名/手机号:<span style="color: red">*</span></label>
	                                        <div class='input-group'>
	                                            <input id="telephoneId" name="telephone" type="text"  class="k-textbox" style="width: 100%;"/>
	                                            <span class='input-group-addon'><i class='fa fa-lg fa-fw fa-lightbulb-o'></i></span>
	                                        </div>
	                                    </div>
	                                </div>
	                            </div>
								<!-- end 用户名称    用户名/手机号 -->
								<!-- 联系QQ/座机号码 -->
								<div class="row">
	                                <div class="col-xs-6">
	                                    <div class="form-group">
	                                        <label for="last_name_cn">联系QQ:</label>
	                                        <div class='input-group'>
	                                            <input id="qqId" name="qq" type="text"  class="k-textbox" style="width: 100%;"/>
	                                            <span class='input-group-addon'><i class='fa fa-lg fa-fw fa-lightbulb-o'></i></span>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div class="col-xs-6">
	                                    <div class="form-group">
	                                        <label for="last_name_cn">座机号码:</label>
	                                        <div class='input-group'>
	                                            <input id="landlineId" name="landline" type="text" class="k-textbox" style="width: 100%;"/>
	                                            <span class='input-group-addon'><i class='fa fa-lg fa-fw fa-lightbulb-o'></i></span>
	                                        </div>
	                                    </div>
	                                </div>
	                            </div>
	                            <!-- end 联系QQ/座机号码 -->
	                            <!-- 电子邮箱/所属部门 -->
								<div class="row">
	                                <div class="col-xs-6">
	                                    <div class="form-group">
	                                        <label for="last_name_cn">电子邮箱:</label>
	                                        <div class='input-group'>
	                                            <input id="emailId" name="email" type="text" class="k-textbox" style="width: 100%;"/>
	                                            <span class='input-group-addon'><i class='fa fa-lg fa-fw fa-lightbulb-o'></i></span>
	                                        </div>
	                                    </div>
	                                </div>
	                                <div class="col-xs-6">
	                                    <div class="form-group">
	                                        <label for="last_name_cn">所属部门:<span style="color: red">*</span></label>
	                                        <!-- <select id="deptId" name="deptId" onchange="loadSelectJob();" class="form-control input-sm inputWidth">
					                        </select> -->
					                        <div class='input-group'>
	                                            <select id="deptId"
	                                                    data-role="dropdownlist"
	                                                    data-filter="startswith"
	                                                    data-suggest="true"
	                                                    data-auto-bind="true"
	                                                    data-value-primitive="true"
	                                                    data-text-field="text"
	                                                    data-value-field="value"
	                                                    data-bind=""
	                                                    style="width: 100%;" required validationMessage=" " name="deptId"></select>
	                                            <span class='input-group-addon'><i class='fa fa-lg fa-fw fa-lightbulb-o'></i></span>
	                                        </div>
	                                    </div>
	                                </div>
	                            </div>
	                            <!-- end 电子邮箱/所属部门 -->
	                            <!-- 用户职位/用户是否禁用 -->
								<div class="row">
	                                <div class="col-xs-6">
	                                    <div class="form-group">
		                                    <div class="form-group">
		                                    <label for="last_name_cn">用户职位:<span style="color: red">*</span></label>
		                                        <!-- <select id="jobId" name="jobId"  class="form-control input-sm inputWidth">
						              			</select> -->
						              		<div class='input-group'>
	                                            <select id="jobId"
	                                                    data-role="dropdownlist"
	                                                    data-filter="startswith"
	                                                    data-suggest="true"
	                                                    data-auto-bind="true"
	                                                    data-value-primitive="true"
	                                                    data-text-field="text"
	                                                    data-value-field="value"
	                                                    data-bind=""
	                                                    style="width: 100%;" required validationMessage=" " name="jobId"></select>
	                                            <span class='input-group-addon'><i class='fa fa-lg fa-fw fa-lightbulb-o'></i></span>
	                                        </div>
		                                	</div>
	                                	</div>
	                            	</div>
	                            	<div class="col-xs-6">
	                                    <div class="form-group">
	                                        <label for="last_name_cn">用户是否禁用:</label>
	                                        <div class='input-group'>
	                                            <select id="disableUserStatusId" name="disableUserStatus" style="width:100%; height: 27.37px;border-color: #c9c9c9;"
	                                                    data-role="dropdownlist"
	                                                    data-value-primitive="true"
	                                                    data-bind="value:customer.travel.period">
	                                                <option value="1" selected="selected">否</option>
	                                                <option value="2">是</option>
	                                            </select>
	                                            <span class='input-group-addon'><i class='fa fa-lg fa-fw fa-lightbulb-o'></i></span>
	                                        </div>
	                                    </div>
	                            	 </div>
	                        </div><!-- end 电子邮箱/所属部门 -->
	                      </div>
	                   </form>   
                    </li>
                </ul>
            </div>
        </div>
        <div class="row" data-bind="visible:showToolBar">
        	<div class="col-xs-4">
                <div class="form-group">
                    <button id="deleteFlagId" class="k-red k-button col-xs-12"><i class="fa fa-save"></i> 删除</button>
                </div>
            </div>
            <div class="col-xs-4">
                <div class="form-group">
                    <button id="saveBtn" class="k-primary k-button col-xs-12"><i class="fa fa-save"></i> 保存</button>
                </div>
            </div>
            <div class="col-xs-4">
                <div class="form-group">
                    <button id="initPasswordId" class="k-button col-xs-12"><i class="fa fa-save"></i> 密码初始化</button>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
<!--引入 js 库文件-->
<script src="/res/plugin/template.js"></script>
<script src="/res/plugin/jquery.min.js"></script>
<script src="/res/plugin/kendoui/js/kendo.web.min.js"></script>
<script src="/res/plugin/kendoui/js/cultures/kendo.culture.zh-CN.min.js"></script>
<script src="/res/plugin/kendoui/js/messages/kendo.messages.zh-CN.min.js"></script>
<script src="/res/js/common.js"></script>
<script src="/res/plugin/webtoolkit.md5.js"></script>
<script src="/res/js/idcard.js"></script>
<script src="/res/js/employee/employeelist.js"></script>
<!-- <script src="/res/js/wintone.js?v=4"></script> -->
<script src="/res/plugin/layer/layer.js"></script>
<script type="text/javascript">
loadSelectDept();
//回显数据
function GetQueryString(name)
{
     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
     var r = window.location.search.substr(1).match(reg);
     if(r!=null)return  unescape(r[2]); return null;
}
//是否禁用用户回显
function display(optionID){
   var all_options = document.getElementById("disableUserStatusId").options;
   for (i=0; i<all_options.length; i++){
      if (all_options[i].value == optionID)  // 根据option标签的ID来进行判断  测试的代码这里是两个等号
      {
         all_options[i].selected = true;
      }
   }
}
//循环出部门下拉框
function loadSelectDept(){
	$.ajax({
		url : localhostPaht+'/visa/employeemanage/queryDeptName',
		success : function(data) {
			var data = JSON.parse(data);
			var aa = data.queryList;
			var str = '<option value="">--请选择--</option>';
			for (var i = 0; i < aa.length; i++) {
				str += '<option value="'+aa[i].id+'">'+aa[i].deptname+'</option>';
			}
			$('#deptId').html(str);
			var deptId = GetQueryString("deptId");
			$("#deptId").val(deptId);
			loadSelectJob();
		},
		error : function(request) {
			
		}
	});
}
//根据部门id联动查询职位
function loadSelectJob(){
	var deptId = $("#deptId").val();
	var jobId = GetQueryString("jobId");
	$.ajax({
		url : localhostPaht+'/visa/employeemanage/selectJobName?deptId='+deptId,
		success : function(data) {
			var data = JSON.parse(data);
			console.log("第一次："+JSON.stringify(data));
			var str = '<option value="">--请选择--</option>';
			for (var i = 0; i < data.length; i++) {
				if(jobId==data[i].id){
					str += '<option value="'+data[i].id+'" selected="selected">'+data[i].jobName+'</option>';
				}else{
					str += '<option value="'+data[i].id+'">'+data[i].jobName+'</option>';
				}
			}
			$('#jobId').html(str);
		},
		error : function(request) {
			
		}
	});
}
//调用方法
var uid = GetQueryString("uid");
$("#uid").val(uid);
$.ajax({
	type : "POST",
	url : localhostPaht +'/visa/employeemanage/updateData',
	data : {
		uid:uid
	},
	success : function(data) {
		var data=JSON.parse(data);
		var userinfo = data.one;
		//用户信息
		$('#fullNameId').val(userinfo.fullname);
		$('#telephoneId').val(userinfo.telephone);
		$('#qqId').val(userinfo.qq);
		$('#landlineId').val(userinfo.landline);
		$('#emailId').val(userinfo.email);
		display(userinfo.disableuserstatus);
		//部门职位信息
		var deptjobinfo = data.userDeptList;
		var str = '<option value="">--请选择--</option>';
		for(var i=0;i<deptjobinfo.length;i++){
			var deptId = deptjobinfo[i].id;
			var deptName = deptjobinfo[i].deptname;
			if(deptId==userinfo.deptid){
				str += '<option value="'+deptId+'" selected="selected">'+deptName+'</option>';
			}else{
				str += '<option value="'+deptId+'">'+deptName+'</option>';
			}
		}
			$('#deptId').html(str);
	},
	error : function(request) {
		layer.msg('更新失败');
	}
});
//编辑保存
$("#saveBtn").click(function(){
	$.ajax({
		type : "POST",
		url : localhostPaht +'/visa/employeemanage/updateUserData',
		data : $('#updateForm').serialize(),// 你的formid
		success : function(data) {
			layer.load(1, {
				 shade: [0.1,'#fff'] //0.1透明度的白色背景
			});
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
		    parent.layer.close(index);
		    window.parent.successCallback('2');
		},
		error : function(request) {
			layer.msg('编辑失败');
		}
	});
});
//删除数据
$("#deleteFlagId").click(function(){
	var userId =  $("#uid").val();
	layer.confirm("您确认删除信息吗？", {
	    btn: ["是","否"], //按钮
	    shade: false //不显示遮罩
	}, function(){
		// 点击确定之后
		var url = localhostPaht +'/visa/employeemanage/deleteUserData';
		$.ajax({
			type : 'POST',
			data : {
				userId : userId
			},
			url : url,
			success : function(data) {
				if(data=="true"){
					var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
				     parent.layer.close(index);
				     window.parent.successCallback('3');
				}else{
					layer.msg("删除失败", "", 3000);
				}
			},
			error : function(xhr) {
				layer.msg("操作失败", "", 3000);
			}
		});
	}, function(){
	    // 取消之后不用处理
	});
});
//初始化密码
$("#initPasswordId").click(function(){
	var userId =  $("#uid").val();
	layer.confirm("您确认初始化密码吗？", {
	    btn: ["是","否"], //按钮
	    shade: false //不显示遮罩
	}, function(){
		// 点击确定之后
		var url = localhostPaht +'/visa/employeemanage/initpassword';
		$.ajax({
			type : 'POST',
			data : {
				userId : userId
			},
			url : url,
			success : function(data) {
				if(data=="true"){
					var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
				     parent.layer.close(index);
				     window.parent.successCallback('4');
				}else{
					layer.msg("初始化密码失败", "", 3000);
				}
			},
			error : function(xhr) {
				layer.msg("操作失败", "", 3000);
			}
		});
	}, function(){
	    // 取消之后不用处理
	});
});

$(function(){
	$('#deptId').kendoDropDownList();//所属部门 初始化
	$('#jobId').kendoDropDownList();//用户职位 初始化
});
</script>
</html>
